---
title: "Webhooks"
description: "Receba notifica√ß√µes em tempo real sobre transa√ß√µes PIX na StylePay"
---

## Vis√£o Geral

Os webhooks da StylePay permitem que sua aplica√ß√£o receba notifica√ß√µes autom√°ticas sobre mudan√ßas de status em transa√ß√µes PIX, incluindo:

- **PIX Cash-in** - Recebimentos via QR Code
- **PIX Cash-out** - Pagamentos e saques PIX
- **Refund (MED)** - Estornos de dep√≥sitos

<Note>
  Existem dois tipos de webhooks: **Entrada** (provedor ‚Üí StylePay) e **Sa√≠da** (StylePay ‚Üí sua aplica√ß√£o). Esta documenta√ß√£o foca nos webhooks de **sa√≠da**, que voc√™ precisa configurar.
</Note>

## Como Configurar

Voc√™ pode configurar a URL de callback de duas formas:

### 1. Por Transa√ß√£o (Recomendado)

<CodeGroup>

```json Gerar QR Code PIX
{
  "amount": 100.50,
  "external_id": "pedido_123",
  "postbackUrl": "https://seusite.com/webhook/pix",
  ...
}
```

```json Pagamento PIX
{
  "amount": 50.00,
  "description": "Pagamento fornecedor",
  "callbackUrl": "https://seusite.com/webhook/pix-payment",
  ...
}
```

</CodeGroup>

### 2. URL Global (Fallback)

Configure uma URL padr√£o no painel StylePay para transa√ß√µes que n√£o especificarem uma URL pr√≥pria.

<Tip>
  A StylePay sempre tenta usar a URL espec√≠fica da transa√ß√£o primeiro. A URL global √© usada apenas como fallback.
</Tip>

## Eventos Dispon√≠veis

### PIX Cash-in (Recebimentos)

| Evento | Status | Descri√ß√£o |
|--------|--------|-----------|
| `pix.cashin.pending` | PENDING | Cobran√ßa criada, aguardando pagamento |
| `pix.cashin.paid` | PAID | Pagamento confirmado |

### PIX Cash-out (Pagamentos)

| Evento | Status | Descri√ß√£o |
|--------|--------|-----------|
| `pix.cashout.pending` | PENDING | Pagamento criado, processando |
| `pix.cashout.paid` | PAID | Pagamento realizado com sucesso |
| `pix.cashout.cancelled` | CANCELLED | Pagamento cancelado ou falhou |

### Refund (Estornos)

| Evento | Status | Descri√ß√£o |
|--------|--------|-----------|
| `pix.refund.paid_out` | CANCELLED | Dep√≥sito estornado via MED |

## Estrutura dos Payloads

### PIX Cash-in - Pagamento Confirmado

```json
{
  "event": "pix.cashin.paid",
  "requestNumber": "pedido_123",
  "statusTransaction": "PAID",
  "idTransaction": "550e8400-e29b-41d4-a716-446655440000",
  "typeTransaction": "PIX",
  "value": 100.50,
  "debtorName": "Jo√£o Silva",
  "debtorDocument": "12345678900",
  "date": "2025-01-01T10:02:00.000Z",
  "endToEnd": "E2E9A8B7C6D5E4F3...",
  "providerPayload": {
    "// Payload original do provedor"
  }
}
```

<Accordion title="Campos do Payload - Cash-in">
  <ResponseField name="event" type="string" required>
    Tipo do evento (`pix.cashin.paid` ou `pix.cashin.pending`)
  </ResponseField>

  <ResponseField name="requestNumber" type="string" required>
    Seu identificador externo (`external_id`) informado na cria√ß√£o
  </ResponseField>

  <ResponseField name="statusTransaction" type="string" required>
    Status atual da transa√ß√£o (`PENDING`, `PAID`)
  </ResponseField>

  <ResponseField name="idTransaction" type="string" required>
    UUID √∫nico da transa√ß√£o na StylePay
  </ResponseField>

  <ResponseField name="typeTransaction" type="string" required>
    Tipo da transa√ß√£o (sempre `PIX` para cash-in)
  </ResponseField>

  <ResponseField name="value" type="number" required>
    Valor da transa√ß√£o em reais
  </ResponseField>

  <ResponseField name="debtorName" type="string">
    Nome do pagador
  </ResponseField>

  <ResponseField name="debtorDocument" type="string">
    CPF/CNPJ do pagador
  </ResponseField>

  <ResponseField name="date" type="string" required>
    Data/hora do evento em formato ISO 8601
  </ResponseField>

  <ResponseField name="endToEnd" type="string">
    Identificador end-to-end do PIX (dispon√≠vel quando pago)
  </ResponseField>

  <ResponseField name="providerPayload" type="object">
    Payload original enviado pelo provedor
  </ResponseField>
</Accordion>

### PIX Cash-out - Pagamento Realizado

```json
{
  "event": "pix.cashout.paid",
  "idTransaction": "7c9e6679-7425-40de-944b-e07fc1f90ae7",
  "statusTransaction": "PAID",
  "date": "2025-01-01T11:00:00.000Z",
  "message": null,
  "value": 200.00,
  "endToEnd": "E2E123ABC456DEF...",
  "providerPayload": {
    "// Payload original do provedor"
  }
}
```

### PIX Cash-out - Pagamento Cancelado

```json
{
  "event": "pix.cashout.cancelled",
  "idTransaction": "7c9e6679-7425-40de-944b-e07fc1f90ae7",
  "statusTransaction": "CANCELLED",
  "date": "2025-01-01T11:05:00.000Z",
  "message": "NOT_PAID",
  "value": 200.00,
  "endToEnd": "E2E123ABC456DEF...",
  "providerPayload": {
    "// Payload original do provedor"
  }
}
```

<Accordion title="Campos do Payload - Cash-out">
  <ResponseField name="event" type="string" required>
    Tipo do evento (`pix.cashout.paid`, `pix.cashout.cancelled`, `pix.cashout.pending`)
  </ResponseField>

  <ResponseField name="idTransaction" type="string" required>
    UUID √∫nico da transa√ß√£o na StylePay
  </ResponseField>

  <ResponseField name="statusTransaction" type="string" required>
    Status atual da transa√ß√£o (`PENDING`, `PAID`, `CANCELLED`)
  </ResponseField>

  <ResponseField name="date" type="string" required>
    Data/hora do evento em formato ISO 8601
  </ResponseField>

  <ResponseField name="message" type="string">
    Mensagem adicional sobre o status (ex: `NOT_PAID` quando cancelado)
  </ResponseField>

  <ResponseField name="value" type="number" required>
    Valor da transa√ß√£o em reais
  </ResponseField>

  <ResponseField name="endToEnd" type="string">
    Identificador end-to-end do PIX
  </ResponseField>

  <ResponseField name="providerPayload" type="object">
    Payload original enviado pelo provedor
  </ResponseField>
</Accordion>

### Refund - Estorno de Dep√≥sito

```json
{
  "event": "pix.refund.paid_out",
  "requestNumber": "pedido_123",
  "statusTransaction": "CANCELLED",
  "idTransaction": "550e8400-e29b-41d4-a716-446655440000",
  "typeTransaction": "PIX_REFUND",
  "value": 100.50,
  "debtorName": "Jo√£o Silva",
  "debtorDocument": "12345678900",
  "date": "2025-01-01T12:00:00.000Z",
  "endToEnd": "E2EREFUND123ABC...",
  "providerPayload": {
    "// Payload original do provedor MED"
  }
}
```

<Warning>
  Refunds (estornos) **apenas** ocorrem em transa√ß√µes do tipo `DEPOSIT` (cash-in). Nunca s√£o aplicados em saques (cash-out).
</Warning>

## Implementa√ß√£o do Endpoint

Seu endpoint deve estar preparado para receber requisi√ß√µes POST da StylePay:

<CodeGroup>

```javascript Node.js/Express
app.post('/webhook/pix', async (req, res) => {
  try {
    const { event, idTransaction, statusTransaction } = req.body;
    
    // Verificar se j√° processou este webhook (idempot√™ncia)
    const exists = await db.webhooks.findOne({ 
      idTransaction, 
      event 
    });
    
    if (exists) {
      return res.status(200).json({ received: true });
    }
    
    // Processar o webhook baseado no evento
    switch (event) {
      case 'pix.cashin.paid':
        await handleCashInPaid(req.body);
        break;
      case 'pix.cashout.paid':
        await handleCashOutPaid(req.body);
        break;
      case 'pix.cashout.cancelled':
        await handleCashOutCancelled(req.body);
        break;
      case 'pix.refund.paid_out':
        await handleRefund(req.body);
        break;
    }
    
    // Salvar registro do webhook
    await db.webhooks.create({
      idTransaction,
      event,
      payload: req.body,
      processedAt: new Date()
    });
    
    // IMPORTANTE: Responder rapidamente
    res.status(200).json({ received: true });
    
  } catch (error) {
    console.error('Erro ao processar webhook:', error);
    res.status(500).json({ error: 'Internal server error' });
  }
});
```

```python Python/Flask
from flask import Flask, request, jsonify
from datetime import datetime

app = Flask(__name__)

@app.route('/webhook/pix', methods=['POST'])
def webhook_pix():
    try:
        data = request.get_json()
        event = data.get('event')
        id_transaction = data.get('idTransaction')
        
        # Verificar idempot√™ncia
        if webhook_exists(id_transaction, event):
            return jsonify({'received': True}), 200
        
        # Processar baseado no evento
        if event == 'pix.cashin.paid':
            handle_cashin_paid(data)
        elif event == 'pix.cashout.paid':
            handle_cashout_paid(data)
        elif event == 'pix.cashout.cancelled':
            handle_cashout_cancelled(data)
        elif event == 'pix.refund.paid_out':
            handle_refund(data)
        
        # Salvar registro
        save_webhook(id_transaction, event, data)
        
        # Responder rapidamente
        return jsonify({'received': True}), 200
        
    except Exception as e:
        print(f"Erro ao processar webhook: {e}")
        return jsonify({'error': 'Internal server error'}), 500
```

```php PHP
<?php

// webhook.php
header('Content-Type: application/json');

try {
    $payload = json_decode(file_get_contents('php://input'), true);
    
    $event = $payload['event'];
    $idTransaction = $payload['idTransaction'];
    
    // Verificar idempot√™ncia
    if (webhookExists($idTransaction, $event)) {
        echo json_encode(['received' => true]);
        http_response_code(200);
        exit;
    }
    
    // Processar baseado no evento
    switch ($event) {
        case 'pix.cashin.paid':
            handleCashInPaid($payload);
            break;
        case 'pix.cashout.paid':
            handleCashOutPaid($payload);
            break;
        case 'pix.cashout.cancelled':
            handleCashOutCancelled($payload);
            break;
        case 'pix.refund.paid_out':
            handleRefund($payload);
            break;
    }
    
    // Salvar registro
    saveWebhook($idTransaction, $event, $payload);
    
    // Responder rapidamente
    echo json_encode(['received' => true]);
    http_response_code(200);
    
} catch (Exception $e) {
    error_log("Erro ao processar webhook: " . $e->getMessage());
    echo json_encode(['error' => 'Internal server error']);
    http_response_code(500);
}
?>
```

</CodeGroup>

## Boas Pr√°ticas

<AccordionGroup>
  <Accordion title="1. Implemente Idempot√™ncia">
    Webhooks podem ser enviados mais de uma vez. Use uma combina√ß√£o de `idTransaction + event` como chave √∫nica para evitar processamento duplicado.
    
    ```javascript
    const webhookKey = `${idTransaction}-${event}`;
    if (await cache.exists(webhookKey)) {
      return res.status(200).json({ received: true });
    }
    ```
  </Accordion>

  <Accordion title="2. Responda Rapidamente">
    Retorne status 200 em at√© 5 segundos. Processe l√≥gica complexa de forma ass√≠ncrona ap√≥s responder.
    
    ```javascript
    // Responder primeiro
    res.status(200).json({ received: true });
    
    // Processar depois (n√£o bloqueante)
    processWebhookAsync(req.body).catch(console.error);
    ```
  </Accordion>

  <Accordion title="3. Valide o Evento">
    Sempre valide o campo `event` antes de processar para garantir que est√° tratando o tipo correto.
    
    ```javascript
    const validEvents = [
      'pix.cashin.paid',
      'pix.cashin.pending',
      'pix.cashout.paid',
      'pix.cashout.cancelled',
      'pix.refund.paid_out'
    ];
    
    if (!validEvents.includes(event)) {
      console.warn(`Evento desconhecido: ${event}`);
    }
    ```
  </Accordion>

  <Accordion title="4. Registre Logs">
    Mantenha um log completo de todos os webhooks recebidos para auditoria e debugging.
    
    ```javascript
    await db.webhook_logs.create({
      idTransaction: data.idTransaction,
      event: data.event,
      payload: JSON.stringify(data),
      receivedAt: new Date(),
      ipAddress: req.ip
    });
    ```
  </Accordion>

  <Accordion title="5. Seguran√ßa">
    - Mantenha sua URL de webhook privada
    - Use HTTPS obrigatoriamente
    - Considere implementar autentica√ß√£o via header customizado
    - Valide o formato dos dados recebidos
    
    ```javascript
    // Exemplo de valida√ß√£o de header customizado
    const webhookSecret = req.headers['x-webhook-secret'];
    if (webhookSecret !== process.env.WEBHOOK_SECRET) {
      return res.status(401).json({ error: 'Unauthorized' });
    }
    ```
  </Accordion>

  <Accordion title="6. Tratamento de Erros">
    Se sua aplica√ß√£o retornar erro (4xx/5xx), a StylePay pode retentar o envio. Implemente retry logic robusto.
    
    ```javascript
    try {
      await processWebhook(data);
    } catch (error) {
      // Log do erro
      console.error('Erro:', error);
      
      // Se for erro tempor√°rio, retorne 5xx para retry
      if (error.isTemporary) {
        return res.status(503).json({ error: 'Service temporarily unavailable' });
      }
      
      // Se for erro permanente, retorne 200 para evitar retries
      return res.status(200).json({ received: true, error: error.message });
    }
    ```
  </Accordion>
</AccordionGroup>

## Fluxo de Atualiza√ß√£o de Saldo

<Info>
  A StylePay atualiza automaticamente o saldo da carteira. Os webhooks servem para manter seu sistema sincronizado com essas mudan√ßas.
</Info>

### Cash-in (Recebimento)
- Quando `pix.cashin.paid` √© recebido, o saldo l√≠quido j√° foi creditado na carteira StylePay

### Cash-out (Pagamento)
- No momento da cria√ß√£o, o valor + taxa j√° foi debitado
- Se cancelado (`pix.cashout.cancelled`), o valor + taxa √© reembolsado automaticamente

### Refund (Estorno)
- Quando `pix.refund.paid_out` √© recebido, o valor l√≠quido j√° foi debitado da carteira

## Testando Webhooks

Para testar webhooks em desenvolvimento local:

<Steps>
  <Step title="Use um t√∫nel">
    Ferramentas como ngrok, localtunnel ou Cloudflare Tunnel para expor sua aplica√ß√£o local
    
    ```bash
    ngrok http 3000
    ```
  </Step>
  
  <Step title="Configure a URL">
    Use a URL p√∫blica gerada como `postbackUrl` ou `callbackUrl`
    
    ```
    https://abc123.ngrok.io/webhook/pix
    ```
  </Step>
  
  <Step title="Monitore os logs">
    Acompanhe os webhooks chegando em tempo real no seu console
  </Step>
</Steps>

## Suporte

Se voc√™ tiver problemas com webhooks:

- üìß Email: suporte@stylepay.com.br
- üì± WhatsApp: +55 11 9999-9999
- üåê Portal: https://suporte.stylepay.com.br