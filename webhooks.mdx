---
title: "Webhooks"
description: "Receba notifica√ß√µes autom√°ticas quando algo acontecer com suas transa√ß√µes PIX"
---

## O que s√£o Webhooks?

Webhooks s√£o notifica√ß√µes autom√°ticas que a StylePay envia para sua aplica√ß√£o quando uma transa√ß√£o PIX muda de status. √â como receber um SMS avisando que um pagamento foi confirmado.

<Info>
  **Em resumo:** Voc√™ informa uma URL do seu site, e a StylePay manda uma mensagem para essa URL sempre que algo importante acontecer.
</Info>

## Passo 1: Configure sua URL

Ao criar uma transa√ß√£o, informe onde quer receber as notifica√ß√µes:

<CodeGroup>

```json Criar QR Code (Recebimento)
{
  "amount": 100.50,
  "external_id": "pedido_123",
  "postbackUrl": "https://seusite.com/webhook",
  ...
}
```

```json Fazer Pagamento
{
  "amount": 50.00,
  "description": "Pagamento",
  "callbackUrl": "https://seusite.com/webhook",
  ...
}
```

</CodeGroup>

<Tip>
  Voc√™ pode usar a mesma URL para todos os tipos de notifica√ß√£o.
</Tip>

## Passo 2: Entenda os Eventos

A StylePay envia 3 tipos principais de notifica√ß√£o:

<CardGroup cols={3}>
  <Card title="Recebimento" icon="arrow-down">
    Quando algu√©m paga seu QR Code
  </Card>
  <Card title="Pagamento" icon="arrow-up">
    Quando seu pagamento √© processado
  </Card>
  <Card title="Estorno" icon="rotate-left">
    Quando um recebimento √© devolvido
  </Card>
</CardGroup>

## Passo 3: Receba as Notifica√ß√µes

### üì• Recebimento Confirmado

Quando algu√©m paga seu QR Code:

```json
{
  "event": "pix.cashin.paid",
  "requestNumber": "pedido_123",
  "statusTransaction": "PAID",
  "idTransaction": "uuid-da-transacao",
  "value": 100.50,
  "debtorName": "Jo√£o Silva",
  "date": "2025-01-01T10:00:00.000Z"
}
```

**Campos importantes:**
- `event`: Sempre ser√° `pix.cashin.paid` para recebimentos
- `requestNumber`: Seu c√≥digo de pedido
- `value`: Quanto voc√™ recebeu
- `debtorName`: Nome de quem pagou

### üì§ Pagamento Realizado

Quando seu pagamento √© conclu√≠do:

```json
{
  "event": "pix.cashout.paid",
  "idTransaction": "uuid-da-transacao",
  "statusTransaction": "PAID",
  "value": 50.00,
  "date": "2025-01-01T11:00:00.000Z"
}
```

### ‚ùå Pagamento Cancelado

Quando seu pagamento falha:

```json
{
  "event": "pix.cashout.cancelled",
  "idTransaction": "uuid-da-transacao",
  "statusTransaction": "CANCELLED",
  "value": 50.00,
  "message": "NOT_PAID"
}
```

### üîÑ Estorno de Recebimento

Quando um pagamento que voc√™ recebeu √© devolvido:

```json
{
  "event": "pix.refund.paid_out",
  "requestNumber": "pedido_123",
  "statusTransaction": "CANCELLED",
  "value": 100.50
}
```

## Passo 4: Crie seu Endpoint

Seu site precisa ter uma p√°gina que receba essas notifica√ß√µes. Aqui est√° um exemplo simples:

<CodeGroup>

```javascript Node.js (Simples)
// Usando Express.js
const express = require('express');
const app = express();

app.use(express.json());

app.post('/webhook', (req, res) => {
  const { event, value, requestNumber } = req.body;
  
  // Identificar o tipo de evento
  if (event === 'pix.cashin.paid') {
    console.log(`‚úÖ Recebido: R$ ${value} - Pedido: ${requestNumber}`);
    // Atualizar seu banco de dados aqui
  }
  
  if (event === 'pix.cashout.paid') {
    console.log(`‚úÖ Pagamento enviado: R$ ${value}`);
  }
  
  if (event === 'pix.cashout.cancelled') {
    console.log(`‚ùå Pagamento cancelado: R$ ${value}`);
  }
  
  // IMPORTANTE: Sempre responda com sucesso
  res.json({ ok: true });
});

app.listen(3000);
```

```python Python (Simples)
from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route('/webhook', methods=['POST'])
def webhook():
    data = request.get_json()
    
    event = data.get('event')
    value = data.get('value')
    request_number = data.get('requestNumber')
    
    # Identificar o tipo de evento
    if event == 'pix.cashin.paid':
        print(f"‚úÖ Recebido: R$ {value} - Pedido: {request_number}")
        # Atualizar seu banco de dados aqui
    
    if event == 'pix.cashout.paid':
        print(f"‚úÖ Pagamento enviado: R$ {value}")
    
    if event == 'pix.cashout.cancelled':
        print(f"‚ùå Pagamento cancelado: R$ {value}")
    
    # IMPORTANTE: Sempre responda com sucesso
    return jsonify({'ok': True}), 200

if __name__ == '__main__':
    app.run(port=3000)
```

```php PHP (Simples)
<?php
// webhook.php

$data = json_decode(file_get_contents('php://input'), true);

$event = $data['event'];
$value = $data['value'];
$requestNumber = $data['requestNumber'] ?? null;

// Identificar o tipo de evento
if ($event === 'pix.cashin.paid') {
    error_log("‚úÖ Recebido: R$ $value - Pedido: $requestNumber");
    // Atualizar seu banco de dados aqui
}

if ($event === 'pix.cashout.paid') {
    error_log("‚úÖ Pagamento enviado: R$ $value");
}

if ($event === 'pix.cashout.cancelled') {
    error_log("‚ùå Pagamento cancelado: R$ $value");
}

// IMPORTANTE: Sempre responda com sucesso
header('Content-Type: application/json');
echo json_encode(['ok' => true]);
?>
```

</CodeGroup>

## 5 Regras Importantes

<Steps>
  <Step title="Sempre responda rapidamente">
    Retorne status `200` em menos de 5 segundos. Se precisar fazer algo demorado, fa√ßa depois de responder.
    
    ```javascript
    // ‚úÖ Certo
    res.json({ ok: true }); // Responde primeiro
    atualizarBancoDeDados(); // Faz depois
    
    // ‚ùå Errado
    atualizarBancoDeDados(); // Demora muito
    res.json({ ok: true }); // Responde depois
    ```
  </Step>

  <Step title="Evite processar duas vezes">
    Guarde o `idTransaction` para n√£o processar a mesma notifica√ß√£o mais de uma vez.
    
    ```javascript
    // Verificar se j√° processou
    if (jaProcessei(idTransaction)) {
      return res.json({ ok: true });
    }
    ```
  </Step>

  <Step title="Use HTTPS">
    Sua URL precisa come√ßar com `https://` (n√£o `http://`)
  </Step>

  <Step title="Verifique o evento">
    Sempre confira o campo `event` antes de processar
    
    ```javascript
    if (event === 'pix.cashin.paid') {
      // Processar recebimento
    }
    ```
  </Step>

  <Step title="Salve tudo">
    Guarde um registro de todas as notifica√ß√µes recebidas para consultar depois
  </Step>
</Steps>

## Testando em Casa

Para testar enquanto desenvolve:

<Steps>
  <Step title="Instale o ngrok">
    Baixe em: https://ngrok.com/download
  </Step>

  <Step title="Execute seu servidor">
    ```bash
    node seu-servidor.js
    ```
  </Step>

  <Step title="Abra um t√∫nel">
    ```bash
    ngrok http 3000
    ```
  </Step>

  <Step title="Use a URL gerada">
    ```
    https://abc123.ngrok.io/webhook
    ```
    
    Cole essa URL no `postbackUrl` ou `callbackUrl`
  </Step>
</Steps>

## Exemplo Completo

Aqui est√° um exemplo completo e funcional:

```javascript
const express = require('express');
const app = express();

app.use(express.json());

// Simula√ß√£o de banco de dados
const processados = new Set();

app.post('/webhook', async (req, res) => {
  const { event, idTransaction, value, requestNumber, statusTransaction } = req.body;
  
  console.log('üì© Webhook recebido:', event);
  
  // 1. Evitar processar duas vezes
  if (processados.has(idTransaction)) {
    console.log('‚ö†Ô∏è  J√° processado anteriormente');
    return res.json({ ok: true });
  }
  
  // 2. Responder rapidamente
  res.json({ ok: true });
  
  // 3. Processar o webhook
  try {
    if (event === 'pix.cashin.paid') {
      console.log(`‚úÖ Pagamento recebido!`);
      console.log(`   Valor: R$ ${value}`);
      console.log(`   Pedido: ${requestNumber}`);
      
      // Atualizar pedido no banco de dados
      // await db.pedidos.update(requestNumber, { status: 'pago' });
    }
    
    if (event === 'pix.cashout.paid') {
      console.log(`‚úÖ Pagamento enviado com sucesso!`);
      console.log(`   Valor: R$ ${value}`);
      
      // Atualizar transa√ß√£o no banco de dados
      // await db.transacoes.update(idTransaction, { status: 'concluido' });
    }
    
    if (event === 'pix.cashout.cancelled') {
      console.log(`‚ùå Pagamento cancelado`);
      console.log(`   Valor: R$ ${value}`);
      
      // Marcar como cancelado
      // await db.transacoes.update(idTransaction, { status: 'cancelado' });
    }
    
    if (event === 'pix.refund.paid_out') {
      console.log(`üîÑ Estorno processado`);
      console.log(`   Valor: R$ ${value}`);
      console.log(`   Pedido: ${requestNumber}`);
      
      // Processar estorno
      // await db.pedidos.update(requestNumber, { status: 'estornado' });
    }
    
    // Marcar como processado
    processados.add(idTransaction);
    
  } catch (error) {
    console.error('‚ùå Erro ao processar:', error);
  }
});

app.listen(3000, () => {
  console.log('üöÄ Servidor rodando na porta 3000');
  console.log('üìç Webhook: http://localhost:3000/webhook');
});
```

## D√∫vidas Frequentes

<AccordionGroup>
  <Accordion title="Minha URL precisa ter autentica√ß√£o?">
    N√£o √© obrigat√≥rio, mas √© recomendado. Voc√™ pode adicionar um token secreto na URL ou verificar um header espec√≠fico.
  </Accordion>

  <Accordion title="E se meu servidor estiver fora do ar?">
    A StylePay tentar√° reenviar a notifica√ß√£o algumas vezes. Por isso √© importante ter um servidor est√°vel.
  </Accordion>

  <Accordion title="Posso usar a mesma URL para tudo?">
    Sim! Voc√™ usa o campo `event` para saber que tipo de notifica√ß√£o recebeu.
  </Accordion>

  <Accordion title="Como sei se recebi todas as notifica√ß√µes?">
    Voc√™ pode consultar o status da transa√ß√£o pela API usando o `idTransaction` se precisar confirmar.
  </Accordion>

  <Accordion title="Preciso responder com algum dado espec√≠fico?">
    N√£o. Basta retornar status HTTP 200. O conte√∫do da resposta n√£o importa.
  </Accordion>
</AccordionGroup>

## Precisa de Ajuda?

<CardGroup cols={2}>
  <Card title="Suporte T√©cnico" icon="headset">
    suporte@stylepay.com.br
  </Card>
  <Card title="WhatsApp" icon="whatsapp">
    +55 11 9999-9999
  </Card>
</CardGroup>